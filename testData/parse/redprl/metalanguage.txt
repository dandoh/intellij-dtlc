FILE
  PsiComment(line comment)('// RedPRL's metalanguage is called RedML. RedPRL documents are really sequences of RedML declarations!')
  PsiWhiteSpace('\n')
  PsiComment(line comment)('// RedML is like "CBPV with nominal characteristics"; later it will develop to a full ML.')
  PsiWhiteSpace('\n\n')
  RedPrlMlDeclDefImpl(ML_DECL_DEF)
    PsiElement(DEFINE)('define')
    PsiWhiteSpace(' ')
    RedPrlOpDeclImpl(OP_DECL)
      PsiElement(OPNAME)('Op')
    PsiWhiteSpace(' ')
    PsiElement(EQUALS)('=')
    PsiWhiteSpace(' ')
    RedPrlTermImpl(TERM)
      RedPrlTermAndTacImpl(TERM_AND_TAC)
        PsiElement(LPAREN)('(')
        PsiElement(LAMBDA)('lam')
        PsiWhiteSpace(' ')
        PsiElement(LSQUARE)('[')
        RedPrlBoundVarImpl(BOUND_VAR)
          PsiElement(VARNAME)('x')
        PsiElement(RSQUARE)(']')
        PsiWhiteSpace(' ')
        RedPrlTermImpl(TERM)
          RedPrlVarUsageImpl(VAR_USAGE)
            PsiElement(VARNAME)('x')
        PsiElement(RPAREN)(')')
  PsiElement(DOT)('.')
  PsiWhiteSpace('\n\n')
  PsiComment(line comment)('// we can suspend a command to execute later. "{ cmd }" turns a command into a value (thunk),')
  PsiWhiteSpace('\n')
  PsiComment(line comment)('// and "^ val" is the command that returns a value.')
  PsiWhiteSpace('\n')
  RedPrlMlDeclValImpl(ML_DECL_VAL)
    PsiElement(VAL)('val')
    PsiWhiteSpace(' ')
    RedPrlOpDeclImpl(OP_DECL)
      PsiElement(OPNAME)('MyCmd')
    PsiWhiteSpace(' ')
    PsiElement(EQUALS)('=')
    PsiWhiteSpace(' ')
    RedPrlMlAtomicCmdImpl(ML_ATOMIC_CMD)
      PsiElement(CARET)('^')
      PsiWhiteSpace(' ')
      RedPrlMlValueImpl(ML_VALUE)
        PsiElement(LBRACKET)('{')
        PsiWhiteSpace(' ')
        RedPrlMlAtomicCmdImpl(ML_ATOMIC_CMD)
          PsiElement(PRINT)('print')
          PsiWhiteSpace(' ')
          RedPrlMlValueImpl(ML_VALUE)
            RedPrlOpUsageImpl(OP_USAGE)
              PsiElement(OPNAME)('Op')
        PsiWhiteSpace(' ')
        PsiElement(RBRACKET)('}')
  PsiElement(DOT)('.')
  PsiWhiteSpace('\n\n')
  RedPrlMlDeclImpl(ML_DECL)
    RedPrlMlCmdLetImpl(ML_CMD_LET)
      PsiElement(LET)('let')
      PsiWhiteSpace('\n  ')
      RedPrlMlDeclTheoremImpl(ML_DECL_THEOREM)
        PsiElement(THEOREM)('theorem')
        PsiWhiteSpace(' ')
        RedPrlOpDeclImpl(OP_DECL)
          PsiElement(OPNAME)('Bar')
        RedPrlDeclArgumentsParensImpl(DECL_ARGUMENTS_PARENS)
          PsiElement(LPAREN)('(')
          RedPrlDeclArgumentImpl(DECL_ARGUMENT)
            RedPrlMetaVarImpl(META_VAR)
              PsiElement(HASH)('#')
              RedPrlIdentImpl(IDENT)
                PsiElement(VARNAME)('l')
            PsiElement(COLON)(':')
            RedPrlSortImpl(SORT)
              PsiElement(LVL)('lvl')
          PsiElement(RPAREN)(')')
        PsiWhiteSpace(' ')
        PsiElement(COLON)(':')
        PsiWhiteSpace(' ')
        RedPrlJudgmentImpl(JUDGMENT)
          RedPrlTermImpl(TERM)
            RedPrlTermAndTacImpl(TERM_AND_TAC)
              PsiElement(LPAREN)('(')
              PsiElement(RIGHT_ARROW)('->')
              PsiWhiteSpace(' ')
              RedPrlArrowQuantifierDataImpl(ARROW_QUANTIFIER_DATA)
                RedPrlTypedBinderImpl(TYPED_BINDER)
                  PsiElement(LSQUARE)('[')
                  RedPrlBoundVarImpl(BOUND_VAR)
                    PsiElement(VARNAME)('ty')
                  PsiWhiteSpace(' ')
                  PsiElement(COLON)(':')
                  PsiWhiteSpace(' ')
                  RedPrlTermImpl(TERM)
                    RedPrlTermAndTacImpl(TERM_AND_TAC)
                      PsiElement(LPAREN)('(')
                      PsiElement(UNIVERSE)('U')
                      PsiWhiteSpace(' ')
                      RedPrlLevelImpl(LEVEL)
                        RedPrlMetaVarImpl(META_VAR)
                          PsiElement(HASH)('#')
                          RedPrlIdentImpl(IDENT)
                            PsiElement(VARNAME)('l')
                      PsiWhiteSpace(' ')
                      RedPrlTermImpl(TERM)
                        RedPrlTermAndTacImpl(TERM_AND_TAC)
                          RedPrlNullaryOperatorImpl(NULLARY_OPERATOR)
                            RedPrlKindImpl(KIND)
                              PsiElement(KAN)('kan')
                      PsiElement(RPAREN)(')')
                  PsiElement(RSQUARE)(']')
                PsiWhiteSpace(' ')
                RedPrlArrowQuantifierDataImpl(ARROW_QUANTIFIER_DATA)
                  RedPrlTermImpl(TERM)
                    RedPrlVarUsageImpl(VAR_USAGE)
                      PsiElement(VARNAME)('ty')
                  PsiWhiteSpace(' ')
                  RedPrlArrowQuantifierDataImpl(ARROW_QUANTIFIER_DATA)
                    RedPrlTermImpl(TERM)
                      RedPrlVarUsageImpl(VAR_USAGE)
                        PsiElement(VARNAME)('ty')
              PsiElement(RPAREN)(')')
        PsiWhiteSpace(' ')
        PsiElement(BY)('by')
        PsiWhiteSpace(' ')
        PsiElement(LBRACKET)('{')
        PsiWhiteSpace('\n    ')
        RedPrlAtomicMultitacImpl(ATOMIC_MULTITAC)
          RedPrlLambdaTacImpl(LAMBDA_TAC)
            PsiElement(LAMBDA)('lam')
            PsiWhiteSpace(' ')
            RedPrlDevDecompPatternImpl(DEV_DECOMP_PATTERN)
              RedPrlVarDeclImpl(VAR_DECL)
                PsiElement(VARNAME)('ty')
            PsiWhiteSpace(' ')
            RedPrlDevDecompPatternImpl(DEV_DECOMP_PATTERN)
              RedPrlVarDeclImpl(VAR_DECL)
                PsiElement(VARNAME)('x')
            PsiWhiteSpace(' ')
            PsiElement(DOUBLE_RIGHT_ARROW)('=>')
            PsiWhiteSpace(' ')
            RedPrlAtomicMultitacImpl(ATOMIC_MULTITAC)
              RedPrlUseElimTacImpl(USE_ELIM_TAC)
                PsiElement(USE)('use')
                PsiWhiteSpace(' ')
                RedPrlVarUsageImpl(VAR_USAGE)
                  PsiElement(VARNAME)('x')
        PsiWhiteSpace('\n  ')
        PsiElement(RBRACKET)('}')
      PsiElement(SEMI)(';')
      PsiWhiteSpace('\n  ')
      RedPrlMlCmdLetImpl(ML_CMD_LET)
        PsiElement(LET)('let')
        PsiWhiteSpace(' ')
        RedPrlMlDeclValImpl(ML_DECL_VAL)
          PsiElement(VAL)('val')
          PsiWhiteSpace(' ')
          RedPrlOpDeclImpl(OP_DECL)
            PsiElement(OPNAME)('M')
          PsiWhiteSpace(' ')
          PsiElement(EQUALS)('=')
          PsiWhiteSpace(' ')
          RedPrlMlAtomicCmdImpl(ML_ATOMIC_CMD)
            PsiElement(EXTRACT)('extract')
            PsiWhiteSpace(' ')
            RedPrlMlValueImpl(ML_VALUE)
              RedPrlOpUsageImpl(OP_USAGE)
                PsiElement(OPNAME)('Bar')
        PsiElement(SEMI)(';')
        PsiWhiteSpace('\n  ')
        RedPrlMlAtomicCmdImpl(ML_ATOMIC_CMD)
          PsiElement(PRINT)('print')
          PsiWhiteSpace(' ')
          RedPrlMlValueImpl(ML_VALUE)
            RedPrlOpUsageImpl(OP_USAGE)
              PsiElement(OPNAME)('M')
  PsiElement(DOT)('.')
  PsiWhiteSpace('\n\n')
  PsiComment(line comment)('// Bar no longer in scope')
  PsiWhiteSpace('\n\n\n')
  PsiComment(line comment)('// now let's go ahead and run our command')
  PsiWhiteSpace('\n')
  RedPrlMlDeclImpl(ML_DECL)
    RedPrlMlAtomicCmdImpl(ML_ATOMIC_CMD)
      PsiElement(BANG)('!')
      RedPrlMlValueImpl(ML_VALUE)
        RedPrlOpUsageImpl(OP_USAGE)
          PsiElement(OPNAME)('MyCmd')
  PsiElement(DOT)('.')